---
import type { MenuItemDefinition } from '../utils/menu-item-definition';
import type { MainMenuSettings } from '../utils/nav-bar-settings';
import BranchMenuItem from './BranchMenuItem.astro';

export interface Props {
    settings: MainMenuSettings;
    menuItemDefinitions: readonly MenuItemDefinition[];
};

const { settings, menuItemDefinitions } = Astro.props;
---

<menu class="main-menu">
    {
        menuItemDefinitions.map((definition) => <BranchMenuItem settings={settings} menuItemDefinition={definition} />)
    }
</menu>

<style lang="scss" define:vars={{
    mainMenuFontFamily: settings.mainMenuFontFamily,
    wideMainMenuFontSize: settings.wideMainMenuFontSize,
    narrowMainMenuFontSize: settings.narrowMainMenuFontSize,
    mainMenuBackgroundColor: settings.mainMenuBackgroundColor,
    narrowMainMenuMaxWidth: settings.narrowMainMenuMaxWidth,
    mainMenuMargin: settings.mainMenuMargin,
    mainMenuPadding: settings.mainMenuPadding,
    wideMainMenuFlexGap: settings.wideMainMenuFlexGap,
    narrowMainMenuFlexGap: settings.narrowMainMenuFlexGap,
    narrowMainMenuBoxShadow: settings.narrowMainMenuBoxShadow,
    narrowMenuItemPadding: settings.narrowMenuItemPadding,
}}>
    @use '/main-menu'; // Sass is only used to to allow media breakpoint to be specified by a variable.  Otherwise rest of style is plain CSS.

    .main-menu {
        display: flex;
        font-family: var(--mainMenuFontFamily, inherit);
        font-size: var(--wideMainMenuFontSize, 1.2em);
        background-color: var(--mainMenuBackgroundColor, inherit);
        margin: var(--mainMenuMargin, 0);
        padding: var(--mainMenuPadding, 0);
        gap: var(--wideMainMenuFlexGap, .8em);

        @media screen and ((hover: none) or (width < main-menu.$narrow-breakpoint)) {
            position: absolute;
            display: none;
            top: 100%;
            right: 0;
            flex-direction: column;
            font-size: var(--narrowMainMenuFontSize, 1.2em);
            gap: var(--narrowMainMenuFlexGap, 0.18rem);
            max-width: var(--narrowMainMenuMaxWidth, 15em);
            box-shadow: var(--narrowMainMenuBoxShadow, 0 .1rem .4rem black);

            &.displayed {
                display: flex;
                width: 100%;
            }
        }
    }
</style>
